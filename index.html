<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weathr - Global Weather Forecast</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

:root {
    --bg-color: #f7f7f7;
    --text-color: #222;
    --accent-color: #4f46e5;
    --card-bg: #ffffff;
    --shadow: rgba(0,0,0,0.1);
}

body.dark-mode {
    --bg-color: #1e1e1e;
    --text-color: #f0f0f0;
    --accent-color: #8a4fff;
    --card-bg: #2a2a2a;
    --shadow: rgba(0,0,0,0.4);
}

* { box-sizing:border-box; font-family:'Roboto',sans-serif; }
body {
    margin:0; padding:0;
    display:flex; justify-content:center; align-items:flex-start;
    min-height:100vh; background:var(--bg-color); color:var(--text-color);
    transition:0.3s; padding:20px;
}

.weather-app {
    position:relative;
    background: var(--bg-color);
    border-radius: 15px;
    padding: 30px 20px;
    max-width: 450px;
    width: 100%;
    border: 1px solid var(--shadow);
    box-shadow: 0 4px 12px var(--shadow);
}

.toggle-dark {
    position: absolute; top: 15px; right: 15px;
    width: 40px; height: 40px; border-radius: 50%;
    background: var(--card-bg);
    display: flex; justify-content: center; align-items: center;
    font-size: 20px; color: var(--accent-color); cursor: pointer; transition:0.3s;
}
.toggle-dark:hover { transform: translateY(-2px); }

.weather-app h1 { text-align:center; margin-bottom: 15px; font-size: 22px; }
.weather-app .icon { display:block; margin:0 auto 15px auto; width:60px; height:60px; }

.input-section { display:flex; gap:8px; justify-content:center; margin-bottom:20px; flex-wrap:wrap; }
.input-section input {
    flex:1 1 60%; padding:10px; border-radius:10px; border:1px solid var(--shadow);
    font-size:14px; outline:none; background: var(--card-bg); color: var(--text-color);
}
.input-section button {
    padding:10px 12px; border-radius:10px; border:none; background: var(--accent-color);
    color:#fff; cursor:pointer; font-size:14px; transition:0.3s;
}
.input-section button:hover { opacity:0.85; }

.current-weather, .hourly, .forecast {
    background: var(--card-bg); border-radius:12px; padding:20px;
    margin-bottom:20px; box-shadow:0 2px 8px var(--shadow);
}

.hourly { display:flex; overflow-x:auto; gap:10px; }
.forecast { display:grid; grid-template-columns: repeat(auto-fill, minmax(100px,1fr)); gap:12px; overflow-x:auto; }

.forecast-card { background: var(--card-bg); border-radius:12px; padding:10px; text-align:center; font-size:12px; box-shadow:0 1px 6px var(--shadow); }

footer { text-align:center; margin-top:12px; font-size:12px; color:var(--text-color); }

@media(max-width:500px){
    .input-section input { flex:1 1 100%; }
    .forecast { grid-auto-flow: column; grid-template-columns: repeat(7,100px); overflow-x:scroll; }
}
</style>
</head>
<body>

<div class="weather-app">
    <div class="toggle-dark" onclick="toggleDarkMode()">🌙</div>
    <img class="icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB/0lEQVR4nO2Z0W3DMBCEhWTozpuPuvEP1EZyi3KZcp3bdoEoAkbQ6r7tDM6JkWWkYMCbzvvNwB5iAH4JsmkB3S6AUdAK9tWZdcD1zG5dTRUExFm5FMiCzASktg3uOZcVnYhAPGVmwbeGcBt3BBIFj2h/NFvZoDUACz2UxuSu2c9EGdZwQ7F0S0IiG6k4wwphb8AgWcUmlzGf+4BVAk/AnL4N6o2u1u+FB2mxOfjNdN8tkYTzzJIpXxJZ9jhdKSW9s2u5Qjltz6XAE8qV0Vv92pQKlw50IXwU4BsTiPlYAFHiUyZ7VfqM3RYAcqO7E0uCwkwCsRKAG8oKnk5D3cAA3KDqwV3IDPZ3EJr52mNEk1X4jEGBqa6SLL5zV/Ep92N0TXcAvI+u6S0vgVtGzAJ1V3tK0gcAAYZyJyzG8QAEH+28Mn0sLrZQ4kSxAAIfO+P1UZcAYHfq/ghoAWcQXthgrgAUp0s5vXc3qP3x3xOT4M7cnXYe5r8QPksN0dYw8zKISn0AqZjE5Ur7Ojx9EkB7IpmQjpx9/3kH4FzI++0yTuf3/2BOI3+5lYP8BKthz4aJ1s3AAAAAElFTkSuQmCC" alt="Weather Icon">
    <h1>Weathr</h1>

    <div class="input-section">
        <input type="text" id="cityInput" placeholder="Enter city">
        <button onclick="manualWeather()">Search</button>
        <button onclick="getWeather()">Refresh</button>
    </div>

    <div class="current-weather" id="current">Detecting your location...</div>
    <div class="hourly" id="hourly"></div>
    <div class="forecast" id="forecast"></div>

    <footer>© Manik Roy 2025</footer>
</div>

<script>
function toggleDarkMode(){ document.body.classList.toggle('dark-mode'); }

function getWeatherDescription(code){
    switch(code){
        case 0: return "Clear sky"; case 1: return "Mainly clear"; case 2: return "Partly cloudy";
        case 3: return "Overcast"; case 45: return "Fog"; case 48: return "Depositing rime fog";
        case 51: return "Light drizzle"; case 53: return "Moderate drizzle"; case 55: return "Dense drizzle";
        case 56: return "Light freezing drizzle"; case 57: return "Dense freezing drizzle";
        case 61: return "Slight rain"; case 63: return "Moderate rain"; case 65: return "Heavy rain";
        case 66: return "Light freezing rain"; case 67: return "Heavy freezing rain";
        case 71: return "Slight snow fall"; case 73: return "Moderate snow fall"; case 75: return "Heavy snow fall";
        case 77: return "Snow grains"; case 80: return "Slight rain showers"; case 81: return "Moderate rain showers";
        case 82: return "Violent rain showers"; case 85: return "Slight snow showers"; case 86: return "Heavy snow showers";
        case 95: return "Thunderstorm"; case 96: return "Thunderstorm with slight hail"; case 99: return "Thunderstorm with heavy hail";
        default: return "Unknown";
    }
}

async function getCoordinates(city){
    try{
        const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(city)}`);
        const data = await res.json();
        if(data && data.length>0) return {lat:data[0].lat, lon:data[0].lon};
        else throw "City not found";
    } catch(e){ throw "Unable to get coordinates"; }
}

async function fetchWeather(city){
    try{
        const coords = await getCoordinates(city);
        fetchWeatherByCoords(coords.lat, coords.lon, city);
    } catch(e){
        document.getElementById('current').innerHTML = `Unable to fetch weather: ${e}`;
    }
}

function updateLastFetched(){
    const now = new Date();
    const lastUpdate = now.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true});
    const existing = document.getElementById('lastUpdate');
    if(existing) existing.remove();
    const p = document.createElement('p');
    p.id='lastUpdate';
    p.style.fontSize='10px'; p.style.marginTop='5px';
    p.textContent=`Last updated: ${lastUpdate}`;
    document.getElementById('current').appendChild(p);
}

async function fetchWeatherByCoords(lat, lon, cityName='Current Location'){
    const currentDiv = document.getElementById('current');
    const forecastDiv = document.getElementById('forecast');
    const hourlyDiv = document.getElementById('hourly');
    forecastDiv.innerHTML=''; hourlyDiv.innerHTML='';

    try{
        const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,weathercode,relativehumidity_2m&daily=temperature_2m_max,temperature_2m_min,weathercode&timezone=auto`);
        const data = await weatherRes.json();

        const current = data.current_weather;
        const temp = current.temperature;
        const wind = current.windspeed;
        const weatherDesc = getWeatherDescription(current.weathercode);
        const localTime = new Date(current.time).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true});

        currentDiv.innerHTML=`
            <h2>${cityName}</h2>
            <p><strong>Time:</strong> ${localTime}</p>
            <p><strong>Temp:</strong> ${temp}°C</p>
            <p><strong>Weather:</strong> ${weatherDesc}</p>
            <p><strong>Wind:</strong> ${wind} km/h</p>
        `;
        updateLastFetched();

        // 24-hour forecast
        for(let i=0;i<24;i++){
            const hourTime = new Date(data.hourly.time[i]).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true});
            const hourTemp = data.hourly.temperature_2m[i];
            const hourHum = data.hourly.relativehumidity_2m[i];
            const code = data.hourly.weathercode[i];
            let icon="☀️";
            if([51,53,55,61,63,65,80,81,82].includes(code)) icon="🌧️";
            else if([71,73,75,77,85,86].includes(code)) icon="❄️";
            else if([95,96,99].includes(code)) icon="⛈️";

            const hourCard = document.createElement('div');
            hourCard.className='forecast-card';
            hourCard.innerHTML=`<strong>${hourTime}</strong><div style="font-size:20px">${icon}</div><div>${hourTemp}°C | ${hourHum}%</div>`;
            hourlyDiv.appendChild(hourCard);
        }

        // 7-day forecast
        for(let i=0;i<7;i++){
            const dayMax = data.daily.temperature_2m_max[i];
            const dayMin = data.daily.temperature_2m_min[i];
            const code = data.daily.weathercode[i];
            let icon="☀️";
            if([51,53,55,61,63,65,80,81,82].includes(code)) icon="🌧️";
            else if([71,73,75,77,85,86].includes(code)) icon="❄️";
            else if([95,96,99].includes(code)) icon="⛈️";

            const dayName = new Date(data.daily.time[i]).toLocaleDateString('en-US',{weekday:'short'});
            const card = document.createElement('div');
            card.className='forecast-card';
            card.innerHTML=`<strong>${dayName}</strong><div style="font-size:24px">${icon}</div><div>${dayMax}°C / ${dayMin}°C</div>`;
            forecastDiv.appendChild(card);
        }

    } catch(e){ currentDiv.innerHTML=`Unable to fetch weather: ${e}`; }
}

// Auto detect GPS with location name
function getWeather(){
    const cityInput = document.getElementById('cityInput');
    cityInput.value=''; // Clear input

    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(
            async (pos)=>{
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                let cityName = 'Current Location';
                try{
                    const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);
                    const data = await res.json();
                    if(data.address){
                        cityName = data.address.city || data.address.town || data.address.village || data.address.state || 'Current Location';
                    }
                }catch(err){ console.warn('Unable to get location name', err); }
                fetchWeatherByCoords(lat, lon, cityName);
            },
            async (err)=>{
                console.warn(err.message);
                try{
                    const ipRes = await fetch('https://ipapi.co/json/');
                    const ipData = await ipRes.json();
                    const cityName = ipData.city || 'Current Location';
                    fetchWeatherByCoords(ipData.latitude, ipData.longitude, cityName);
                }catch{
                    document.getElementById('current').innerHTML='Unable to detect location';
                }
            },
            { enableHighAccuracy:true, timeout:10000, maximumAge:0 }
        );
    } else {
        document.getElementById('current').innerHTML='Geolocation not supported';
    }
}

// Manual search
function manualWeather(){
    const city = document.getElementById('cityInput').value.trim();
    if(city) fetchWeather(city);
}

// On page load
window.onload = getWeather;

// Auto-update weather every hour
setInterval(() => { getWeather(); }, 3600000); // 1 hour interval
</script>

</body>
</html>
